import{b1 as ie,aX as ue,b2 as ce,b3 as pe,h as me,n as _e,_ as fe,w as ve,E,aQ as ge,O as T}from"./index-85698657.js";import{E as be}from"./el-card-ee291327.js";import{E as he}from"./el-tree-df991ed6.js";import"./el-checkbox-2208f569.js";import{c as te,a as we,b as ye}from"./el-progress-36781325.js";import{E as O,r as G}from"./users-48779947.js";import{E as R}from"./el-dialog-7c1cb757.js";import"./el-overlay-e2e59763.js";import{E as H,a as K}from"./el-form-item-d9be28d1.js";import{E as le}from"./el-input-b354c633.js";/* empty css               */import{E as se,a as ne}from"./el-select-1116a6ab.js";import"./el-popper-957bc5d5.js";import{b as Y,d as Ie,a as Ve,e as Ce,f as Ue,h as Z}from"./courses-8c5a59ed.js";import{d as x,V as ke,o as U,Y as D,Z as C,a2 as q,u as e,c as P,a5 as F,aa as Ee,a9 as j,a6 as $,K as w,N as J,w as n,O as M,a as l,ad as I,ar as ae,F as ee}from"./runtime-core.esm-bundler-d5958d54.js";import{_ as z}from"./_plugin-vue_export-helper-c27b6911.js";import{E as Se}from"./el-switch-c6f39bad.js";import"./index-1d23def1.js";import"./index-c83fc9da.js";import"./isEqual-11ce6184.js";import"./_Uint8Array-5ce3f6a6.js";import"./flatten-daf2af9e.js";import"./index-9231dd87.js";import"./refs-e5ab6f88.js";import"./scroll-880816f1.js";import"./_initCloneObject-e1c979fb.js";import"./index-0cd3e709.js";const L={success:"icon-success",warning:"icon-warning",error:"icon-error",info:"icon-info"},oe={[L.success]:ie,[L.warning]:ue,[L.error]:ce,[L.info]:pe},Ne=me({title:{type:String,default:""},subTitle:{type:String,default:""},icon:{type:String,values:["success","warning","info","error"],default:"info"}}),$e=x({name:"ElResult"}),Ae=x({...$e,props:Ne,setup(V){const g=V,v=_e("result"),a=ke(()=>{const u=g.icon,f=u&&L[u]?L[u]:"icon-info",t=oe[f]||oe["icon-info"];return{class:f,component:t}});return(u,f)=>(U(),D("div",{class:F(e(v).b())},[C("div",{class:F(e(v).e("icon"))},[q(u.$slots,"icon",{},()=>[e(a).component?(U(),P(Ee(e(a).component),{key:0,class:F(e(a).class)},null,8,["class"])):j("v-if",!0)])],2),u.title||u.$slots.title?(U(),D("div",{key:0,class:F(e(v).e("title"))},[q(u.$slots,"title",{},()=>[C("p",null,$(u.title),1)])],2)):j("v-if",!0),u.subTitle||u.$slots["sub-title"]?(U(),D("div",{key:1,class:F(e(v).e("subtitle"))},[q(u.$slots,"sub-title",{},()=>[C("p",null,$(u.subTitle),1)])],2)):j("v-if",!0),u.$slots.extra?(U(),D("div",{key:2,class:F(e(v).e("extra"))},[q(u.$slots,"extra")],2)):j("v-if",!0)],2))}});var De=fe(Ae,[["__file","/home/runner/work/element-plus/element-plus/packages/components/result/src/result.vue"]]);const re=ve(De);const xe={class:"dialog-footer"},Te=x({__name:"SectionStatusChange",emits:["statusChange"],setup(V,{expose:g,emit:v}){const a=w(!1),u="140px",f=J({status:0});let t="";g({showAndInit:(_,o)=>{t="当前状态为: "+S[o.status],Object.assign(f,o),a.value=!0}});const S=["隐藏","待更新","已发布"],k=async()=>{const{data:_}=await Y(f);if(_.code==="000000")a.value=!1,v("statusChange");else throw E.error("修改章节状态失败..."),new Error("修改章节状态失败...")};return(_,o)=>{const m=re,r=se,p=ne,h=H,d=K,c=O,i=R;return U(),P(i,{modelValue:e(a),"onUpdate:modelValue":o[2]||(o[2]=s=>M(a)?a.value=s:null),title:"更改章节状态","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:n(()=>[C("span",xe,[l(c,{onClick:o[1]||(o[1]=s=>a.value=!1)},{default:n(()=>[I("取消")]),_:1}),l(c,{type:"primary",onClick:k},{default:n(()=>[I(" 提交 ")]),_:1})])]),default:n(()=>[l(m,{icon:"info",title:e(t)},null,8,["title"]),l(d,{model:e(f)},{default:n(()=>[l(h,{label:"状态更改为","label-width":u},{default:n(()=>[l(p,{modelValue:e(f).status,"onUpdate:modelValue":o[0]||(o[0]=s=>e(f).status=s),placeholder:""},{default:n(()=>[(U(),D(ee,null,ae(S,(s,y)=>l(r,{key:s,label:s,value:y},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}});const Fe=z(Te,[["__scopeId","data-v-cf4e51c3"]]),Le={class:"dialog-footer"},Oe=x({__name:"SectionDialogCreateOrEdit",emits:["sectionRefresh"],setup(V,{expose:g,emit:v}){const a=w(!1),u="140px",f=()=>({id:void 0,courseId:0,courseName:"",sectionName:"",description:"",orderNum:0,status:0}),t=w(f()),b=w("");g({showAndInit:async(_,o)=>{if(t.value=f(),o){b.value="更新章节";const{data:m}=await Ie(o);if(m.code==="000000"){console.log(m.data);const{id:r,sectionName:p,description:h,orderNum:d}=m.data;Object.assign(t.value,{id:r,sectionName:p,description:h,orderNum:d})}else throw E.error("获取章节信息失败.."+m.mesg),new Error("获取章节信息失败.."+m.mesg)}else b.value="新建章节";t.value.courseName=_.courseName,t.value.courseId=_.id,a.value=!0}});const k=async()=>{const{data:_}=await Y(t.value);if(_.code==="000000")E.success(`${b.value}成功!`),a.value=!1,v("sectionRefresh");else throw E.error(`${b.value}失败...`),new Error(`${b.value}失败...`)};return(_,o)=>{const m=le,r=H,p=te,h=K,d=O,c=R;return U(),P(c,{modelValue:e(a),"onUpdate:modelValue":o[5]||(o[5]=i=>M(a)?a.value=i:null),title:e(b),"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:n(()=>[C("span",Le,[l(d,{onClick:o[4]||(o[4]=i=>a.value=!1)},{default:n(()=>[I("取消")]),_:1}),l(d,{type:"primary",onClick:k},{default:n(()=>[I(" 确认 ")]),_:1})])]),default:n(()=>[l(h,{model:e(t),"label-position":"top"},{default:n(()=>[l(r,{label:"课程名称","label-width":u},{default:n(()=>[l(m,{modelValue:e(t).courseName,"onUpdate:modelValue":o[0]||(o[0]=i=>e(t).courseName=i),autocomplete:"off",disabled:""},null,8,["modelValue"])]),_:1}),l(r,{label:"章节名称","label-width":u},{default:n(()=>[l(m,{modelValue:e(t).sectionName,"onUpdate:modelValue":o[1]||(o[1]=i=>e(t).sectionName=i),autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(r,{label:"章节描述","label-width":u},{default:n(()=>[l(m,{modelValue:e(t).description,"onUpdate:modelValue":o[2]||(o[2]=i=>e(t).description=i),autocomplete:"off",type:"textarea"},null,8,["modelValue"])]),_:1}),l(r,{label:"章节排序","label-width":u},{default:n(()=>[l(p,{modelValue:e(t).orderNum,"onUpdate:modelValue":o[3]||(o[3]=i=>e(t).orderNum=i),autocomplete:"off","controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}});const Pe=z(Oe,[["__scopeId","data-v-ee05448e"]]),A=w({}),X=w([]),B=async V=>{const{data:g}=await Ve(V);if(g.code==="000000")A.value=g.data;else throw E.error("获取课程基本信息失败.."+g.mesg),new Error("获取课程基本信息失败.."+g.mesg);const{data:v}=await Ce(V);if(v.code==="000000")X.value=v.data;else throw E.error("获取课程中的章节与课时信息失败..."+v.mesg),new Error("获取课程中的章节与课时信息失败..."+v.mesg)},ze={class:"dialog-footer"},Be=x({__name:"LessonDialogCreateOrEdit",emits:["lessonChange"],setup(V,{expose:g,emit:v}){const a=w(!1),u="140px",f=()=>({id:void 0,courseId:0,sectionId:0,theme:"",duration:"0",isFree:!1,orderNum:0,status:0,courseName:"",sectionName:""}),t=J(f());let b="";g({showAndInit:async(_,o,m)=>{if(Object.assign(t,f()),_.level===1)b="添加课时",t.sectionId=o.id,t.sectionName=o.sectionName;else if(_.level===2){t.id=o.id,t.sectionId=_.parent.data.id,t.sectionName=_.parent.data.sectionName;const{data:r}=await Ue(o.id);r.code==="000000"?(t.theme=r.data.theme,t.duration=r.data.duration,t.isFree=r.data.isFree,t.orderNum=r.data.orderNum,t.status=r.data.status):(t.theme=o.theme,t.duration=o.duration,t.isFree=o.isFree,t.orderNum=o.orderNum,t.status=o.status),b="更新课时"}t.courseId=m.id,t.courseName=m.courseName,a.value=!0}});const k=async()=>{const{data:_}=await Z(t);if(_.code==="000000")a.value=!1,v("lessonChange"),E.success(`${b}成功!`);else throw E.error(`${b}失败...`),new Error(`${b}失败...`)};return(_,o)=>{const m=le,r=H,p=Se,h=te,d=K,c=O,i=R;return U(),P(i,{modelValue:e(a),"onUpdate:modelValue":o[7]||(o[7]=s=>M(a)?a.value=s:null),title:e(b),"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:n(()=>[C("span",ze,[l(c,{onClick:o[6]||(o[6]=s=>a.value=!1)},{default:n(()=>[I("取消")]),_:1}),l(c,{type:"primary",onClick:k},{default:n(()=>[I(" 提交 ")]),_:1})])]),default:n(()=>[l(d,{model:e(t),"label-position":"top"},{default:n(()=>[l(r,{label:"课程名称","label-width":u},{default:n(()=>[l(m,{modelValue:e(t).courseName,"onUpdate:modelValue":o[0]||(o[0]=s=>e(t).courseName=s),disabled:""},null,8,["modelValue"])]),_:1}),l(r,{label:"章节名称","label-width":u},{default:n(()=>[l(m,{modelValue:e(t).sectionName,"onUpdate:modelValue":o[1]||(o[1]=s=>e(t).sectionName=s),disabled:""},null,8,["modelValue"])]),_:1}),l(r,{label:"课时名称","label-width":u},{default:n(()=>[l(m,{modelValue:e(t).theme,"onUpdate:modelValue":o[2]||(o[2]=s=>e(t).theme=s),autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(r,{label:"时长","label-width":u},{default:n(()=>[l(m,{modelValue:e(t).duration,"onUpdate:modelValue":o[3]||(o[3]=s=>e(t).duration=s),autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(r,{label:"是否开放试听","label-width":u},{default:n(()=>[l(p,{modelValue:e(t).isFree,"onUpdate:modelValue":o[4]||(o[4]=s=>e(t).isFree=s),"active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1}),l(r,{label:"课时排序","label-width":u},{default:n(()=>[l(h,{modelValue:e(t).orderNum,"onUpdate:modelValue":o[5]||(o[5]=s=>e(t).orderNum=s),"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}});const je=z(Be,[["__scopeId","data-v-a877b100"]]),Re={class:"dialog-footer"},Me=x({__name:"LessonStatusChange",emits:["lessonStatus"],setup(V,{expose:g,emit:v}){const a=w(!1),u="140px",f=J({status:0});let t="";const b=["隐藏","未发布","已发布"];g({showAndInit:(_,o,m)=>{Object.assign(f,o),t="当前状态为: "+b[o.status],a.value=!0}});const k=async()=>{const{data:_}=await Z(f);_.code==="000000"&&(a.value=!1,v("lessonStatus"))};return(_,o)=>{const m=re,r=se,p=ne,h=H,d=K,c=O,i=R;return U(),P(i,{modelValue:e(a),"onUpdate:modelValue":o[2]||(o[2]=s=>M(a)?a.value=s:null),title:"更改课时状态"},{footer:n(()=>[C("span",Re,[l(c,{onClick:o[1]||(o[1]=s=>a.value=!1)},{default:n(()=>[I("取消")]),_:1}),l(c,{type:"primary",onClick:k},{default:n(()=>[I(" 确定 ")]),_:1})])]),default:n(()=>[l(m,{icon:"info",title:e(t)},null,8,["title"]),l(d,{model:e(f)},{default:n(()=>[l(h,{label:"状态更改为","label-width":u},{default:n(()=>[l(p,{modelValue:e(f).status,"onUpdate:modelValue":o[0]||(o[0]=s=>e(f).status=s),placeholder:""},{default:n(()=>[(U(),D(ee,null,ae(b,(s,y)=>l(r,{key:s,label:s,value:y},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}});const We=z(Me,[["__scopeId","data-v-14d86dff"]]),qe=(V,g)=>G({method:"GET",url:"/boss/course/upload/aliyunVideoUploadAddressAdnAuth.json",params:{fileName:V,imageUrl:g}}),Ge=()=>G({method:"GET",url:"/boss/course/upload/aliyunImagUploadAddressAdnAuth.json"}),He=V=>G({method:"POST",url:"/boss/course/upload/aliyunTransCode.json",data:V}),Ke=V=>G({method:"GET",url:"/boss/course/upload/aliyunTransCodePercent.json",params:{lessonId:V}}),Qe={class:"upload-body"},Xe={class:"el-upload__tip"},Ye={class:"el-upload__tip"},Ze=x({__name:"UploadVideoImageDialog",setup(V,{expose:g}){const v=w(!1),a=w(0);g({showAndInit:(d,c)=>{v.value=!0,a.value=c.id}});const f=w("只支持 mp4 格式."),t=w("只支持 jpg png gif 格式."),b=w(0),S=w(0),k=()=>new AliyunUpload.Vod({userId:"122",region:"",partSize:1048576,parallel:5,retryCount:3,retryDuration:2,onUploadstarted:function(d){},onUploadSucceed:function(d){},onUploadFailed:function(d,c,i){},onUploadProgress:function(d,c,i){},onUploadTokenExpired:function(d){},onUploadEnd:function(d){}}),_=w(""),o=d=>{t.value=d.file.name;const c=k();c.addFile(d.file),c.options.onUploadstarted=async i=>{const{data:s}=await Ge();if(s.code==="000000"){const{uploadAuth:y,uploadAddress:N,imageId:W,imageURL:Q}=s.data;try{c.setUploadAuthAndAddress(i,y,N,W)}catch{console.log("略过上传图片报错信息")}_.value=Q}else throw E.error("获取图片上传凭证失败..."),new Error("获取图片上传凭证失败...")},c.startUpload()},m=w(),r=d=>(m.value=d,f.value=d.name,!1),p=w(),h=()=>{const d=k();d.addFile(m.value),d.options.onUploadstarted=async c=>{const{data:i}=await qe(m.value.name,_.value);if(i.code==="000000"){const{uploadAuth:s,uploadAddress:y,videoId:N}=i.data;try{d.setUploadAuthAndAddress(c,s,y,N)}catch{console.log("略过视频凭证失败的错误信息")}let W=0;const Q=setInterval(()=>{b.value=++W,W===100&&(clearInterval(Q),d.options.onUploadEnd())},500);p.value=N}else throw E.error("获取视频上传凭证失败..."),new Error("获取视频上传凭证失败...")},d.options.onUploadProgress=(c,i,s)=>{b.value=Math.round(s*100)},d.options.onUploadEnd=async()=>{const{data:c}=await He({lessonId:a.value,coverImageUrl:_.value,fileId:p.value,fileName:m.value.name});if(c.code==="000000"){const i=setInterval(()=>{Ke(a.value).then(s=>{S.value=s.data.data,s.data.data===100&&(clearInterval(i),E.success("视频转码成功!"))})},1e3)}},d.startUpload()};return(d,c)=>{const i=O,s=we,y=R;return U(),P(y,{modelValue:e(v),"onUpdate:modelValue":c[0]||(c[0]=N=>M(v)?v.value=N:null),title:"上传视频",width:"40%"},{default:n(()=>[C("div",Qe,[l(s,{class:"upload-demo",action:"#",accept:"video/*","show-file-list":!1,"before-upload":r},{tip:n(()=>[C("div",Xe,$(e(f)),1)]),default:n(()=>[l(i,{type:"primary",plain:""},{default:n(()=>[I("选择视频")]),_:1})]),_:1}),l(s,{class:"upload-demo",action:"#",accept:"image/*","http-request":o,"show-file-list":!1},{tip:n(()=>[C("div",Ye,$(e(t)),1)]),default:n(()=>[l(i,{type:"primary",plain:""},{default:n(()=>[I("选择封面")]),_:1})]),_:1}),l(i,{type:"primary",onClick:h},{default:n(()=>[I("开始上传")]),_:1}),C("h4",null,"视频上传进度: "+$(e(b))+"%",1),C("h4",null,"视频转码进度: "+$(e(S))+"%",1)])]),_:1},8,["modelValue"])}}});const Je=z(Ze,[["__scopeId","data-v-ec0c6c26"]]),eo={class:"flex items-center"},oo={class:"text-large font-600 mr-3"},to={class:"flex items-center"},lo={class:"custom-tree-node"},so={key:0},no={key:1},ao=x({__name:"CourseContent",props:{courseId:{type:String,required:!0}},setup(V){const g=V;B(g.courseId),console.log(A,X);const v=(r,p)=>{console.log(r,p)},a={children:"lessonDTOS",label:r=>r.sectionName||r.theme},u=["隐藏","待更新","已发布"],f=["隐藏","未发布","已发布"],t=w(),b=w(),S=w(),k=w(),_=w(),o=(r,p,h)=>h!=="inner"&&r.parent===p.parent,m=(r,p)=>{const h=p.level===1?Y:Z,d=p.parent.childNodes.map((c,i)=>h({id:c.data.id,orderNum:i+1}));Promise.all(d).then(c=>{if(c.every(s=>s.data.code==="000000"))E.success("节点重新排序成功!");else throw 1}).catch(()=>{throw E.error("节点重新排序失败..."),new Error("节点重新排序失败...")})};return(r,p)=>{const h=O,d=ye,c=he,i=be;return U(),D(ee,null,[l(d,{onBack:p[1]||(p[1]=s=>r.$router.go(-1))},{content:n(()=>[C("div",eo,[C("span",oo,$(e(A).courseName),1)])]),extra:n(()=>[C("div",to,[l(h,{onClick:p[0]||(p[0]=s=>e(t).showAndInit(e(A))),icon:e(ge),type:"primary",class:"ml-2"},{default:n(()=>[I("添加章节")]),_:1},8,["icon"])])]),_:1}),l(i,{class:"box-card"},{default:n(()=>[l(c,{data:e(X),draggable:"","allow-drop":o,props:a,onNodeClick:v,onNodeDrop:m},{default:n(({node:s,data:y})=>[C("span",lo,[C("span",null,$(s.label),1),s.level===1?(U(),D("span",so,[l(h,{size:"large",onClick:T(N=>e(t).showAndInit(e(A),y.id),["stop"])},{default:n(()=>[I("编辑")]),_:2},1032,["onClick"]),l(h,{onClick:T(N=>e(S).showAndInit(s,y,e(A)),["stop"]),size:"large",type:"primary"},{default:n(()=>[I("添加课时")]),_:2},1032,["onClick"]),l(h,{onClick:T(N=>e(b).showAndInit(e(A),y),["stop"]),size:"large"},{default:n(()=>[I($(u[y.status]),1)]),_:2},1032,["onClick"])])):s.level===2?(U(),D("span",no,[l(h,{size:"large",onClick:T(N=>e(S).showAndInit(s,y,e(A)),["stop"])},{default:n(()=>[I("编辑")]),_:2},1032,["onClick"]),l(h,{size:"large",type:"success",onClick:T(N=>e(_).showAndInit(s,y),["stop"])},{default:n(()=>[I("上传视频")]),_:2},1032,["onClick"]),l(h,{onClick:T(N=>e(k).showAndInit(s,y,e(A)),["stop"]),size:"large"},{default:n(()=>[I($(f[y.status]),1)]),_:2},1032,["onClick"])])):j("",!0)])]),_:1},8,["data"])]),_:1}),l(Pe,{ref_key:"sectionDlg",ref:t,onSectionRefresh:p[2]||(p[2]=s=>e(B)(g.courseId))},null,512),l(Fe,{ref_key:"sectionStatusDlg",ref:b,onStatusChange:p[3]||(p[3]=s=>e(B)(g.courseId))},null,512),l(je,{ref_key:"lessonDlg",ref:S,onLessonChange:p[4]||(p[4]=s=>e(B)(g.courseId))},null,512),l(We,{ref_key:"lessonStatusDlg",ref:k,onLessonStatus:p[5]||(p[5]=s=>e(B)(g.courseId))},null,512),l(Je,{ref_key:"uploadDlg",ref:_},null,512)],64)}}});const Fo=z(ao,[["__scopeId","data-v-7f41d6af"]]);export{Fo as default};
